# python3
# Copyright 2022 InstaDeep Ltd. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import numpy as np

# Full dataset tests
matrix_1_expected_data = {
    "mean_norm_return": {
        "algo_1": np.array(
            [[0.40277778, 0.51388889, 0.76388889], [0.20833333, 0.33333333, 0.375]]
        ),
        "algo_2": np.array(
            [[0.36111111, 0.36111111, 0.43055556], [0.33333333, 0.43055556, 0.43055556]]
        ),
        "algo_3": np.array(
            [[0.43055556, 0.40277778, 0.76388889], [0.47222222, 0.58333333, 0.5]]
        ),
    },
    "mean_win_rate": {
        "algo_1": np.array([[0.2, 0.5, 0.7], [0.8, 0.7, 0.6]]),
        "algo_2": np.array([[0.6, 0.9, 0.3], [0.4, 0.8, 0.3]]),
        "algo_3": np.array([[0.1, 0.5, 0.2], [0.1, 0.2, 0.1]]),
    },
}

sample_efficiency_matrix_expected_data = {
    "mean_norm_return": {
        "algo_1": np.array(
            [
                [
                    [0.27777778, 0.16666667, 0.30555556],
                    [0.19444444, 0.38888889, 0.27777778],
                    [0.36111111, 0.91666667, 0.69444444],
                ],
                [
                    [0.13888889, 0.27777778, 0.38888889],
                    [0.5, 0.80555556, 0.61111111],
                    [0.08333333, 0.63888889, 0.63888889],
                ],
            ]
        ),
        "algo_2": np.array(
            [
                [
                    [0.08333333, 0.38888889, 0.5],
                    [0.38888889, 0.47222222, 0.36111111],
                    [0.02777778, 0.36111111, 0.91666667],
                ],
                [
                    [0.55555556, 0.25, 0.52777778],
                    [0.72222222, 0.5, 0.33333333],
                    [0.19444444, 0.16666667, 0.66666667],
                ],
            ]
        ),
        "algo_3": np.array(
            [
                [
                    [0.05555556, 0.11111111, 0.19444444],
                    [0.69444444, 0.58333333, 0.94444444],
                    [0.86111111, 0.41666667, 0.69444444],
                ],
                [
                    [0.72222222, 0.80555556, 0.25],
                    [0.72222222, 0.38888889, 0.41666667],
                    [0.66666667, 0.55555556, 0.63888889],
                ],
            ]
        ),
    },
    "mean_win_rate": {
        "algo_1": np.array(
            [
                [[0.8, 0.5, 0.4], [0.2, 0.5, 0.1], [0.2, 0.6, 0.8]],
                [
                    [0.7, 0.8, 0.4],
                    [0.5, 0.1, 0.2],
                    [0.4, 0.3, 0.2],
                ],
            ]
        ),
        "algo_2": np.array(
            [
                [[0.4, 0.7, 0.4], [0.9, 0.1, 0.1], [0.1, 0.3, 0.1]],
                [[0.2, 0.8, 0.1], [0.2, 0.8, 0.8], [0.2, 0.3, 0.5]],
            ]
        ),
        "algo_3": np.array(
            [
                [
                    [
                        0.1,
                        0.3,
                        0.5,
                    ],
                    [
                        0.6,
                        0.2,
                        0.2,
                    ],
                    [
                        0.3,
                        0.3,
                        0.2,
                    ],
                ],
                [[0.3, 0.2, 0.7], [0.1, 0.4, 0.5], [0.3, 0.3, 0.3]],
            ]
        ),
    },
}

# Single task test data

matrix_1_expected_data_single_task = {
    "mean_norm_return": {
        "algo_1": np.array([[0.40277778], [0.20833333]]),
        "algo_2": np.array([[0.36111111], [0.33333333]]),
        "algo_3": np.array([[0.43055556], [0.47222222]]),
    },
    "mean_win_rate": {
        "algo_1": np.array([[0.2], [0.8]]),
        "algo_2": np.array([[0.6], [0.4]]),
        "algo_3": np.array([[0.1], [0.1]]),
    },
}

sample_efficiency_matrix_expected_data_single_task = {
    "mean_norm_return": {
        "algo_1": np.array(
            [
                [[0.27777778, 0.16666667, 0.30555556]],
                [[0.13888889, 0.27777778, 0.38888889]],
            ]
        ),
        "algo_2": np.array(
            [[[0.08333333, 0.38888889, 0.5]], [[0.55555556, 0.25, 0.52777778]]]
        ),
        "algo_3": np.array(
            [[[0.05555556, 0.11111111, 0.19444444]], [[0.72222222, 0.80555556, 0.25]]]
        ),
    },
    "mean_win_rate": {
        "algo_1": np.array([[[0.8, 0.5, 0.4]], [[0.7, 0.8, 0.4]]]),
        "algo_2": np.array([[[0.4, 0.7, 0.4]], [[0.2, 0.8, 0.1]]]),
        "algo_3": np.array([[[0.1, 0.3, 0.5]], [[0.3, 0.2, 0.7]]]),
    },
}

# Single algorithm multiple task test data
matrix_1_expected_data_single_algorithm = {
    "mean_norm_return": {
        "algo_1": np.array(
            [[0.453125, 0.51388889, 0.76388889], [0.234375, 0.33333333, 0.375]]
        ),
    },
    "mean_win_rate": {
        "algo_1": np.array([[0.2, 0.5, 0.7], [0.8, 0.7, 0.6]]),
    },
}

sample_efficiency_matrix_expected_data_single_algorithm = {
    "mean_norm_return": {
        "algo_1": np.array(
            [
                [
                    [0.3125, 0.1875, 0.34375],
                    [0.19444444, 0.38888889, 0.27777778],
                    [0.36111111, 0.91666667, 0.69444444],
                ],
                [
                    [0.15625, 0.3125, 0.4375],
                    [0.5, 0.80555556, 0.61111111],
                    [0.08333333, 0.63888889, 0.63888889],
                ],
            ]
        ),
    },
    "mean_win_rate": {
        "algo_1": np.array(
            [
                [[0.8, 0.5, 0.4], [0.2, 0.5, 0.1], [0.2, 0.6, 0.8]],
                [[0.7, 0.8, 0.4], [0.5, 0.1, 0.2], [0.4, 0.3, 0.2]],
            ]
        ),
    },
}

expected_processed_data = {
    "env_1": {
        "task_1": {
            "algo_1": {
                "42": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.20833331018518778,
                        "mean_return": 1.875,
                        "mean_win_rate": 0.8,
                        "norm_return": [
                            0.11111109876543349,
                            0.5555554938271674,
                            0.11111109876543349,
                            0.11111109876543349,
                            0.0,
                            0.0,
                            0.5555554938271674,
                            0.22222219753086697,
                        ],
                        "return": [1, 5, 1, 1, 0, 0, 5, 2],
                        "win_rate": [0.8],
                    },
                    "step_1": {
                        "mean_norm_return": 0.13888887345679185,
                        "mean_return": 1.25,
                        "mean_win_rate": 0.7,
                        "norm_return": [
                            0.11111109876543349,
                            0.11111109876543349,
                            0.22222219753086697,
                            0.11111109876543349,
                        ],
                        "return": [1, 1, 2, 1],
                        "step_count": 10006,
                        "win_rate": [0.7],
                    },
                    "step_2": {
                        "mean_norm_return": 0.2777777469135837,
                        "mean_return": 2.5,
                        "mean_win_rate": 0.8,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.5555554938271674,
                            0.22222219753086697,
                        ],
                        "return": [1, 2, 5, 2],
                        "step_count": 20008,
                        "win_rate": [0.8],
                    },
                    "step_3": {
                        "mean_norm_return": 0.38888884567901716,
                        "mean_return": 3.5,
                        "mean_win_rate": 0.4,
                        "norm_return": [
                            0.33333329629630043,
                            0.11111109876543349,
                            0.6666665925926009,
                            0.44444439506173394,
                        ],
                        "return": [3, 1, 6, 4],
                        "step_count": 30000,
                        "win_rate": [0.4],
                    },
                },
                "43289": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.4027777330246963,
                        "mean_return": 3.625,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.5555554938271674,
                            0.8888887901234679,
                            0.44444439506173394,
                            0.11111109876543349,
                            0.22222219753086697,
                            0.33333329629630043,
                            0.5555554938271674,
                            0.11111109876543349,
                        ],
                        "return": [5, 8, 4, 1, 2, 3, 5, 1],
                        "win_rate": [0.2],
                    },
                    "step_1": {
                        "mean_norm_return": 0.2777777469135837,
                        "mean_return": 2.5,
                        "mean_win_rate": 0.8,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.33333329629630043,
                            0.44444439506173394,
                        ],
                        "return": [1, 2, 3, 4],
                        "step_count": 10006,
                        "win_rate": [0.8],
                    },
                    "step_2": {
                        "mean_norm_return": 0.16666664814815024,
                        "mean_return": 1.5,
                        "mean_win_rate": 0.5,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.11111109876543349,
                            0.22222219753086697,
                        ],
                        "return": [1, 2, 1, 2],
                        "step_count": 20008,
                        "win_rate": [0.5],
                    },
                    "step_3": {
                        "mean_norm_return": 0.3055555216049421,
                        "mean_return": 2.75,
                        "mean_win_rate": 0.4,
                        "norm_return": [
                            0.0,
                            0.11111109876543349,
                            0.22222219753086697,
                            0.8888887901234679,
                        ],
                        "return": [0, 1, 2, 8],
                        "step_count": 30000,
                        "win_rate": [0.4],
                    },
                },
            },
            "algo_2": {
                "42": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.3333332962963005,
                        "mean_return": 3.0,
                        "mean_win_rate": 0.4,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.11111109876543349,
                            0.22222219753086697,
                            0.22222219753086697,
                            0.33333329629630043,
                            0.8888887901234679,
                            0.5555554938271674,
                        ],
                        "return": [1, 2, 1, 2, 2, 3, 8, 5],
                        "win_rate": [0.4],
                    },
                    "step_1": {
                        "mean_norm_return": 0.5555554938271674,
                        "mean_return": 5.0,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.11111109876543349,
                            0.5555554938271674,
                            0.8888887901234679,
                            0.6666665925926009,
                        ],
                        "return": [1, 5, 8, 6],
                        "step_count": 10006,
                        "win_rate": [0.2],
                    },
                    "step_2": {
                        "mean_norm_return": 0.24999997222222536,
                        "mean_return": 2.25,
                        "mean_win_rate": 0.8,
                        "norm_return": [
                            0.22222219753086697,
                            0.22222219753086697,
                            0.22222219753086697,
                            0.33333329629630043,
                        ],
                        "return": [2, 2, 2, 3],
                        "step_count": 20008,
                        "win_rate": [0.8],
                    },
                    "step_3": {
                        "mean_norm_return": 0.5277777191358091,
                        "mean_return": 4.75,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.11111109876543349,
                            0.11111109876543349,
                            0.8888887901234679,
                            0.9999998888889013,
                        ],
                        "return": [1, 1, 8, 9],
                        "step_count": 30000,
                        "win_rate": [0.1],
                    },
                },
                "43289": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.3611110709876588,
                        "mean_return": 3.25,
                        "mean_win_rate": 0.6,
                        "norm_return": [
                            0.11111109876543349,
                            0.11111109876543349,
                            0.8888887901234679,
                            0.5555554938271674,
                            0.11111109876543349,
                            0.22222219753086697,
                            0.0,
                            0.8888887901234679,
                        ],
                        "return": [1, 1, 8, 5, 1, 2, 0, 8],
                        "win_rate": [0.6],
                    },
                    "step_1": {
                        "mean_norm_return": 0.08333332407407512,
                        "mean_return": 0.75,
                        "mean_win_rate": 0.4,
                        "norm_return": [
                            0.11111109876543349,
                            0.11111109876543349,
                            0.11111109876543349,
                            0.0,
                        ],
                        "return": [1, 1, 1, 0],
                        "step_count": 10006,
                        "win_rate": [0.4],
                    },
                    "step_2": {
                        "mean_norm_return": 0.38888884567901716,
                        "mean_return": 3.5,
                        "mean_win_rate": 0.7,
                        "norm_return": [
                            0.0,
                            0.5555554938271674,
                            0.0,
                            0.9999998888889013,
                        ],
                        "return": [0, 5, 0, 9],
                        "step_count": 20008,
                        "win_rate": [0.7],
                    },
                    "step_3": {
                        "mean_norm_return": 0.4999999444444507,
                        "mean_return": 4.5,
                        "mean_win_rate": 0.4,
                        "norm_return": [
                            0.8888887901234679,
                            0.5555554938271674,
                            0.22222219753086697,
                            0.33333329629630043,
                        ],
                        "return": [8, 5, 2, 3],
                        "step_count": 30000,
                        "win_rate": [0.4],
                    },
                },
            },
            "algo_3": {
                "42": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.4722221697530923,
                        "mean_return": 4.25,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.11111109876543349,
                            0.6666665925926009,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.0,
                            0.5555554938271674,
                            0.22222219753086697,
                            0.33333329629630043,
                        ],
                        "return": [1, 6, 8, 9, 0, 5, 2, 3],
                        "win_rate": [0.1],
                    },
                    "step_1": {
                        "mean_norm_return": 0.7222221419753176,
                        "mean_return": 6.5,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.11111109876543349,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.8888887901234679,
                        ],
                        "return": [1, 8, 9, 8],
                        "step_count": 10006,
                        "win_rate": [0.3],
                    },
                    "step_2": {
                        "mean_norm_return": 0.8055554660493927,
                        "mean_return": 7.25,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.8888887901234679,
                            0.9999998888889013,
                            0.7777776913580343,
                            0.5555554938271674,
                        ],
                        "return": [8, 9, 7, 5],
                        "step_count": 20008,
                        "win_rate": [0.2],
                    },
                    "step_3": {
                        "mean_norm_return": 0.24999997222222534,
                        "mean_return": 2.25,
                        "mean_win_rate": 0.7,
                        "norm_return": [
                            0.22222219753086697,
                            0.11111109876543349,
                            0.11111109876543349,
                            0.5555554938271674,
                        ],
                        "return": [2, 1, 1, 5],
                        "step_count": 30000,
                        "win_rate": [0.7],
                    },
                },
                "43289": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.4305555077160547,
                        "mean_return": 3.875,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.11111109876543349,
                            0.0,
                            0.22222219753086697,
                            0.5555554938271674,
                            0.0,
                            0.6666665925926009,
                            0.9999998888889013,
                            0.8888887901234679,
                        ],
                        "return": [1, 0, 2, 5, 0, 6, 9, 8],
                        "win_rate": [0.1],
                    },
                    "step_1": {
                        "mean_norm_return": 0.05555554938271674,
                        "mean_return": 0.5,
                        "mean_win_rate": 0.1,
                        "norm_return": [0.0, 0.0, 0.22222219753086697, 0.0],
                        "return": [0, 0, 2, 0],
                        "step_count": 10006,
                        "win_rate": [0.1],
                    },
                    "step_2": {
                        "mean_norm_return": 0.11111109876543349,
                        "mean_return": 1.0,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.0,
                            0.11111109876543349,
                            0.11111109876543349,
                            0.22222219753086697,
                        ],
                        "return": [0, 1, 1, 2],
                        "step_count": 20008,
                        "win_rate": [0.3],
                    },
                    "step_3": {
                        "mean_norm_return": 0.19444442283950858,
                        "mean_return": 1.75,
                        "mean_win_rate": 0.5,
                        "norm_return": [
                            0.0,
                            0.0,
                            0.22222219753086697,
                            0.5555554938271674,
                        ],
                        "return": [0, 0, 2, 5],
                        "step_count": 30000,
                        "win_rate": [0.5],
                    },
                },
            },
        },
        "task_2": {
            "algo_1": {
                "42": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.33333329629630043,
                        "mean_return": 3.0,
                        "mean_win_rate": 0.7,
                        "norm_return": [
                            0.11111109876543349,
                            0.11111109876543349,
                            0.5555554938271674,
                            0.6666665925926009,
                            0.11111109876543349,
                            0.11111109876543349,
                            0.11111109876543349,
                            0.8888887901234679,
                        ],
                        "return": [1, 1, 5, 6, 1, 1, 1, 8],
                        "win_rate": [0.7],
                    },
                    "step_1": {
                        "mean_norm_return": 0.4999999444444506,
                        "mean_return": 4.5,
                        "mean_win_rate": 0.5,
                        "norm_return": [
                            0.0,
                            0.5555554938271674,
                            0.6666665925926009,
                            0.7777776913580343,
                        ],
                        "return": [0, 5, 6, 7],
                        "step_count": 10006,
                        "win_rate": [0.5],
                    },
                    "step_2": {
                        "mean_norm_return": 0.8055554660493928,
                        "mean_return": 7.25,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.5555554938271674,
                            0.8888887901234679,
                            0.7777776913580343,
                            0.9999998888889013,
                        ],
                        "return": [5, 8, 7, 9],
                        "step_count": 20008,
                        "win_rate": [0.1],
                    },
                    "step_3": {
                        "mean_norm_return": 0.6111110432098841,
                        "mean_return": 5.5,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.0,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.5555554938271674,
                        ],
                        "return": [0, 8, 9, 5],
                        "step_count": 30000,
                        "win_rate": [0.2],
                    },
                },
                "43289": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.5138888317901299,
                        "mean_return": 4.625,
                        "mean_win_rate": 0.5,
                        "norm_return": [
                            0.11111109876543349,
                            0.5555554938271674,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.44444439506173394,
                            0.22222219753086697,
                            0.8888887901234679,
                            0.0,
                        ],
                        "return": [1, 5, 8, 9, 4, 2, 8, 0],
                        "win_rate": [0.5],
                    },
                    "step_1": {
                        "mean_norm_return": 0.1944444228395086,
                        "mean_return": 1.75,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.33333329629630043,
                            0.11111109876543349,
                        ],
                        "return": [1, 2, 3, 1],
                        "step_count": 10006,
                        "win_rate": [0.2],
                    },
                    "step_2": {
                        "mean_norm_return": 0.38888884567901716,
                        "mean_return": 3.5,
                        "mean_win_rate": 0.5,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.5555554938271674,
                            0.6666665925926009,
                        ],
                        "return": [1, 2, 5, 6],
                        "step_count": 20008,
                        "win_rate": [0.5],
                    },
                    "step_3": {
                        "mean_norm_return": 0.2777777469135837,
                        "mean_return": 2.5,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.5555554938271674,
                            0.22222219753086697,
                        ],
                        "return": [1, 2, 5, 2],
                        "step_count": 30000,
                        "win_rate": [0.1],
                    },
                },
            },
            "algo_2": {
                "42": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.4305555077160548,
                        "mean_return": 3.875,
                        "mean_win_rate": 0.8,
                        "norm_return": [
                            0.11111109876543349,
                            0.0,
                            0.11111109876543349,
                            0.0,
                            0.5555554938271674,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.7777776913580343,
                        ],
                        "return": [1, 0, 1, 0, 5, 8, 9, 7],
                        "win_rate": [0.8],
                    },
                    "step_1": {
                        "mean_norm_return": 0.7222221419753176,
                        "mean_return": 6.5,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.5555554938271674,
                            0.6666665925926009,
                            0.8888887901234679,
                            0.7777776913580343,
                        ],
                        "return": [5, 6, 8, 7],
                        "step_count": 10006,
                        "win_rate": [0.2],
                    },
                    "step_2": {
                        "mean_norm_return": 0.4999999444444507,
                        "mean_return": 4.5,
                        "mean_win_rate": 0.8,
                        "norm_return": [
                            0.11111109876543349,
                            0.0,
                            0.8888887901234679,
                            0.9999998888889013,
                        ],
                        "return": [1, 0, 8, 9],
                        "step_count": 20008,
                        "win_rate": [0.8],
                    },
                    "step_3": {
                        "mean_norm_return": 0.3333332962963005,
                        "mean_return": 3.0,
                        "mean_win_rate": 0.8,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.5555554938271674,
                            0.44444439506173394,
                        ],
                        "return": [1, 2, 5, 4],
                        "step_count": 30000,
                        "win_rate": [0.8],
                    },
                },
                "43289": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.3611110709876588,
                        "mean_return": 3.25,
                        "mean_win_rate": 0.9,
                        "norm_return": [
                            0.11111109876543349,
                            0.11111109876543349,
                            0.0,
                            0.11111109876543349,
                            0.22222219753086697,
                            0.5555554938271674,
                            0.9999998888889013,
                            0.7777776913580343,
                        ],
                        "return": [1, 1, 0, 1, 2, 5, 9, 7],
                        "win_rate": [0.9],
                    },
                    "step_1": {
                        "mean_norm_return": 0.38888884567901716,
                        "mean_return": 3.5,
                        "mean_win_rate": 0.9,
                        "norm_return": [
                            0.22222219753086697,
                            0.5555554938271674,
                            0.44444439506173394,
                            0.33333329629630043,
                        ],
                        "return": [2, 5, 4, 3],
                        "step_count": 10006,
                        "win_rate": [0.9],
                    },
                    "step_2": {
                        "mean_norm_return": 0.4722221697530923,
                        "mean_return": 4.25,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.11111109876543349,
                            0.11111109876543349,
                            0.6666665925926009,
                            0.9999998888889013,
                        ],
                        "return": [1, 1, 6, 9],
                        "step_count": 20008,
                        "win_rate": [0.1],
                    },
                    "step_3": {
                        "mean_norm_return": 0.3611110709876589,
                        "mean_return": 3.25,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.33333329629630043,
                            0.5555554938271674,
                            0.44444439506173394,
                            0.11111109876543349,
                        ],
                        "return": [3, 5, 4, 1],
                        "step_count": 30000,
                        "win_rate": [0.1],
                    },
                },
            },
            "algo_3": {
                "42": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.5833332685185257,
                        "mean_return": 5.25,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.0,
                            0.5555554938271674,
                            0.6666665925926009,
                            0.6666665925926009,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.8888887901234679,
                            0.0,
                        ],
                        "return": [0, 5, 6, 6, 8, 9, 8, 0],
                        "win_rate": [0.2],
                    },
                    "step_1": {
                        "mean_norm_return": 0.7222221419753176,
                        "mean_return": 6.5,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.11111109876543349,
                            0.8888887901234679,
                            0.8888887901234679,
                            0.9999998888889013,
                        ],
                        "return": [1, 8, 8, 9],
                        "step_count": 10006,
                        "win_rate": [0.1],
                    },
                    "step_2": {
                        "mean_norm_return": 0.38888884567901716,
                        "mean_return": 3.5,
                        "mean_win_rate": 0.4,
                        "norm_return": [
                            0.8888887901234679,
                            0.22222219753086697,
                            0.22222219753086697,
                            0.22222219753086697,
                        ],
                        "return": [8, 2, 2, 2],
                        "step_count": 20008,
                        "win_rate": [0.4],
                    },
                    "step_3": {
                        "mean_norm_return": 0.41666662037037555,
                        "mean_return": 3.75,
                        "mean_win_rate": 0.5,
                        "norm_return": [
                            0.11111109876543349,
                            0.44444439506173394,
                            0.5555554938271674,
                            0.5555554938271674,
                        ],
                        "return": [1, 4, 5, 5],
                        "step_count": 30000,
                        "win_rate": [0.5],
                    },
                },
                "43289": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.4027777330246963,
                        "mean_return": 3.625,
                        "mean_win_rate": 0.5,
                        "norm_return": [
                            0.11111109876543349,
                            0.11111109876543349,
                            0.22222219753086697,
                            0.44444439506173394,
                            0.7777776913580343,
                            0.7777776913580343,
                            0.7777776913580343,
                            0.0,
                        ],
                        "return": [1, 1, 2, 4, 7, 7, 7, 0],
                        "win_rate": [0.5],
                    },
                    "step_1": {
                        "mean_norm_return": 0.6944443672839593,
                        "mean_return": 6.25,
                        "mean_win_rate": 0.6,
                        "norm_return": [
                            0.11111109876543349,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.7777776913580343,
                        ],
                        "return": [1, 8, 9, 7],
                        "step_count": 10006,
                        "win_rate": [0.6],
                    },
                    "step_2": {
                        "mean_norm_return": 0.5833332685185257,
                        "mean_return": 5.25,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.6666665925926009,
                            0.5555554938271674,
                            0.5555554938271674,
                            0.5555554938271674,
                        ],
                        "return": [6, 5, 5, 5],
                        "step_count": 20008,
                        "win_rate": [0.2],
                    },
                    "step_3": {
                        "mean_norm_return": 0.9444443395061846,
                        "mean_return": 8.5,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.9999998888889013,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.8888887901234679,
                        ],
                        "return": [9, 8, 9, 8],
                        "step_count": 30000,
                        "win_rate": [0.2],
                    },
                },
            },
        },
        "task_3": {
            "algo_1": {
                "42": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.374999958333338,
                        "mean_return": 3.375,
                        "mean_win_rate": 0.6,
                        "norm_return": [
                            0.5555554938271674,
                            0.5555554938271674,
                            0.5555554938271674,
                            0.44444439506173394,
                            0.22222219753086697,
                            0.33333329629630043,
                            0.22222219753086697,
                            0.11111109876543349,
                        ],
                        "return": [5, 5, 5, 4, 2, 3, 2, 1],
                        "win_rate": [0.6],
                    },
                    "step_1": {
                        "mean_norm_return": 0.08333332407407512,
                        "mean_return": 0.75,
                        "mean_win_rate": 0.4,
                        "norm_return": [
                            0.0,
                            0.0,
                            0.11111109876543349,
                            0.22222219753086697,
                        ],
                        "return": [0, 0, 1, 2],
                        "step_count": 10006,
                        "win_rate": [0.4],
                    },
                    "step_2": {
                        "mean_norm_return": 0.6388888179012425,
                        "mean_return": 5.75,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.6666665925926009,
                            0.6666665925926009,
                            0.5555554938271674,
                            0.6666665925926009,
                        ],
                        "return": [6, 6, 5, 6],
                        "step_count": 20008,
                        "win_rate": [0.3],
                    },
                    "step_3": {
                        "mean_norm_return": 0.6388888179012425,
                        "mean_return": 5.75,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.7777776913580343,
                            0.6666665925926009,
                            0.6666665925926009,
                            0.44444439506173394,
                        ],
                        "return": [7, 6, 6, 4],
                        "step_count": 30000,
                        "win_rate": [0.2],
                    },
                },
                "43289": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.7638888040123551,
                        "mean_return": 6.875,
                        "mean_win_rate": 0.7,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.9999998888889013,
                            0.9999998888889013,
                            0.9999998888889013,
                            0.9999998888889013,
                            0.9999998888889013,
                            0.7777776913580343,
                        ],
                        "return": [1, 2, 9, 9, 9, 9, 9, 7],
                        "win_rate": [0.7],
                    },
                    "step_1": {
                        "mean_norm_return": 0.3611110709876588,
                        "mean_return": 3.25,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.11111109876543349,
                            0.11111109876543349,
                            0.22222219753086697,
                            0.9999998888889013,
                        ],
                        "return": [1, 1, 2, 9],
                        "step_count": 10006,
                        "win_rate": [0.2],
                    },
                    "step_2": {
                        "mean_norm_return": 0.9166665648148262,
                        "mean_return": 8.25,
                        "mean_win_rate": 0.6,
                        "norm_return": [
                            0.8888887901234679,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.8888887901234679,
                        ],
                        "return": [8, 8, 9, 8],
                        "step_count": 20008,
                        "win_rate": [0.6],
                    },
                    "step_3": {
                        "mean_norm_return": 0.6944443672839593,
                        "mean_return": 6.25,
                        "mean_win_rate": 0.8,
                        "norm_return": [
                            0.5555554938271674,
                            0.5555554938271674,
                            0.6666665925926009,
                            0.9999998888889013,
                        ],
                        "return": [5, 5, 6, 9],
                        "step_count": 30000,
                        "win_rate": [0.8],
                    },
                },
            },
            "algo_2": {
                "42": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.4305555077160548,
                        "mean_return": 3.875,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.0,
                            0.0,
                            0.22222219753086697,
                            0.33333329629630043,
                            0.5555554938271674,
                            0.44444439506173394,
                            0.8888887901234679,
                            0.9999998888889013,
                        ],
                        "return": [0, 0, 2, 3, 5, 4, 8, 9],
                        "win_rate": [0.3],
                    },
                    "step_1": {
                        "mean_norm_return": 0.19444442283950858,
                        "mean_return": 1.75,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.22222219753086697,
                            0.22222219753086697,
                        ],
                        "return": [1, 2, 2, 2],
                        "step_count": 10006,
                        "win_rate": [0.2],
                    },
                    "step_2": {
                        "mean_norm_return": 0.16666664814815021,
                        "mean_return": 1.5,
                        "mean_win_rate": 0.3,
                        "norm_return": [0.0, 0.0, 0.0, 0.6666665925926009],
                        "return": [0, 0, 0, 6],
                        "step_count": 20008,
                        "win_rate": [0.3],
                    },
                    "step_3": {
                        "mean_norm_return": 0.6666665925926009,
                        "mean_return": 6.0,
                        "mean_win_rate": 0.5,
                        "norm_return": [
                            0.0,
                            0.7777776913580343,
                            0.8888887901234679,
                            0.9999998888889013,
                        ],
                        "return": [0, 7, 8, 9],
                        "step_count": 30000,
                        "win_rate": [0.5],
                    },
                },
                "43289": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.4305555077160547,
                        "mean_return": 3.875,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.5555554938271674,
                            0.6666665925926009,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.11111109876543349,
                            0.22222219753086697,
                            0.0,
                            0.0,
                        ],
                        "return": [5, 6, 8, 9, 1, 2, 0, 0],
                        "win_rate": [0.1, 0.5],
                    },
                    "step_1": {
                        "mean_norm_return": 0.02777777469135837,
                        "mean_return": 0.25,
                        "mean_win_rate": 0.1,
                        "norm_return": [0.11111109876543349, 0.0, 0.0, 0.0],
                        "return": [1, 0, 0, 0],
                        "step_count": 10006,
                        "win_rate": [0.1],
                    },
                    "step_2": {
                        "mean_norm_return": 0.3611110709876588,
                        "mean_return": 3.25,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.0,
                            0.22222219753086697,
                            0.5555554938271674,
                            0.6666665925926009,
                        ],
                        "return": [0, 2, 5, 6],
                        "step_count": 20008,
                        "win_rate": [0.3],
                    },
                    "step_3": {
                        "mean_norm_return": 0.9166665648148263,
                        "mean_return": 8.25,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.8888887901234679,
                            0.8888887901234679,
                            0.8888887901234679,
                            0.9999998888889013,
                        ],
                        "return": [8, 8, 8, 9],
                        "step_count": 30000,
                        "win_rate": [0.1],
                    },
                },
            },
            "algo_3": {
                "42": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.4999999444444506,
                        "mean_return": 4.5,
                        "mean_win_rate": 0.1,
                        "norm_return": [
                            0.8888887901234679,
                            0.9999998888889013,
                            0.7777776913580343,
                            0.5555554938271674,
                            0.22222219753086697,
                            0.22222219753086697,
                            0.11111109876543349,
                            0.22222219753086697,
                        ],
                        "return": [8, 9, 7, 5, 2, 2, 1, 2],
                        "win_rate": [0.1],
                    },
                    "step_1": {
                        "mean_norm_return": 0.6666665925926009,
                        "mean_return": 6.0,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.5555554938271674,
                            0.6666665925926009,
                            0.6666665925926009,
                            0.7777776913580343,
                        ],
                        "return": [5, 6, 6, 7],
                        "step_count": 10006,
                        "win_rate": [0.3],
                    },
                    "step_2": {
                        "mean_norm_return": 0.5555554938271674,
                        "mean_return": 5.0,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.0,
                            0.5555554938271674,
                            0.6666665925926009,
                            0.9999998888889013,
                        ],
                        "return": [0, 5, 6, 9],
                        "step_count": 20008,
                        "win_rate": [0.3],
                    },
                    "step_3": {
                        "mean_norm_return": 0.6388888179012425,
                        "mean_return": 5.75,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.11111109876543349,
                            0.5555554938271674,
                            0.8888887901234679,
                            0.9999998888889013,
                        ],
                        "return": [1, 5, 8, 9],
                        "step_count": 30000,
                        "win_rate": [0.3],
                    },
                },
                "43289": {
                    "absolute_metrics": {
                        "mean_norm_return": 0.7638888040123553,
                        "mean_return": 6.875,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.7777776913580343,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.7777776913580343,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.7777776913580343,
                            0.0,
                        ],
                        "return": [7, 8, 9, 7, 8, 9, 7, 0],
                        "win_rate": [0.2],
                    },
                    "step_1": {
                        "mean_norm_return": 0.8611110154321094,
                        "mean_return": 7.75,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.8888887901234679,
                            0.9999998888889013,
                            0.7777776913580343,
                            0.7777776913580343,
                        ],
                        "return": [8, 9, 7, 7],
                        "step_count": 10006,
                        "win_rate": [0.3],
                    },
                    "step_2": {
                        "mean_norm_return": 0.41666662037037555,
                        "mean_return": 3.75,
                        "mean_win_rate": 0.3,
                        "norm_return": [
                            0.11111109876543349,
                            0.22222219753086697,
                            0.5555554938271674,
                            0.7777776913580343,
                        ],
                        "return": [1, 2, 5, 7],
                        "step_count": 20008,
                        "win_rate": [0.3],
                    },
                    "step_3": {
                        "mean_norm_return": 0.6944443672839593,
                        "mean_return": 6.25,
                        "mean_win_rate": 0.2,
                        "norm_return": [
                            0.11111109876543349,
                            0.8888887901234679,
                            0.9999998888889013,
                            0.7777776913580343,
                        ],
                        "return": [1, 8, 9, 7],
                        "step_count": 30000,
                        "win_rate": [0.2],
                    },
                },
            },
        },
    },
    "extra": {
        "algorithm_list": ["algo_1", "algo_2", "algo_3"],
        "environment_list": {"env_1": ["task_1", "task_2", "task_3"]},
        "evaluation_interval": {"env_1": 10000},
        "metric_list": {
            "env_1": [
                "return",
                "win_rate",
                "mean_return",
                "norm_return",
                "mean_norm_return",
                "mean_win_rate",
            ]
        },
        "number_of_runs": 2,
        "number_of_steps": 3,
    },
}

expected_single_task_ci_data_returns = {
    "algo_1": {
        "mean": [0.20833333333333334, 0.2222222222222222, 0.3472222222222222],
        "ci": [0.04304211259673628, 0.03443369007738902, 0.025825267558041775],
    },
    "algo_2": {
        "mean": [0.3194444444444445, 0.3194444444444444, 0.5138888888888888],
        "ci": [0.14634318282890332, 0.04304211259673628, 0.008608422519347275],
    },
    "algo_3": {
        "mean": [0.3888888888888889, 0.45833333333333337, 0.2222222222222222],
        "ci": [0.20660214046433414, 0.21521056298368135, 0.017216845038694507],
    },
}

expected_single_task_ci_data_win_rates = {
    "algo_1": {
        "mean": [0.30000000000000004, 0.44999999999999996, 0.5],
        "ci": [0.061980642139300234, 0.09297096320895035, 0.18594192641790072],
    },
    "algo_2": {
        "mean": [0.15000000000000002, 0.3, 0.3],
        "ci": [0.030990321069650117, 0.0, 0.12396128427860047],
    },
    "algo_3": {"mean": [0.3, 0.3, 0.25], "ci": [0.0, 0.0, 0.030990321069650106]},
}
